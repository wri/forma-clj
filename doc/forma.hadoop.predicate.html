<!DOCTYPE html>
<html><head><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>forma.hadoop.predicate documentation</title></head><body><div id="header"><h1><a href="index.html">Forma 0.8.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><span>Namespaces</span></h3><ul><li><a href="forma.classify.logistic.html"><span>forma.classify.logistic</span></a></li><li><a href="forma.date-time.html"><span>forma.date-time</span></a></li><li><a href="forma.gfw.cdm.html"><span>forma.gfw.cdm</span></a></li><li><a href="forma.hadoop.cli.html"><span>forma.hadoop.cli</span></a></li><li><a href="forma.hadoop.io.html"><span>forma.hadoop.io</span></a></li><li><a href="forma.hadoop.jobs.cdm.html"><span>forma.hadoop.jobs.cdm</span></a></li><li><a href="forma.hadoop.jobs.forma.html"><span>forma.hadoop.jobs.forma</span></a></li><li><a href="forma.hadoop.jobs.modis.html"><span>forma.hadoop.jobs.modis</span></a></li><li><a href="forma.hadoop.jobs.neighbors.html"><span>forma.hadoop.jobs.neighbors</span></a></li><li><a href="forma.hadoop.jobs.preprocess.html"><span>forma.hadoop.jobs.preprocess</span></a></li><li><a href="forma.hadoop.jobs.scatter.html"><span>forma.hadoop.jobs.scatter</span></a></li><li><a href="forma.hadoop.jobs.timeseries.html"><span>forma.hadoop.jobs.timeseries</span></a></li><li><a href="forma.hadoop.pail.html"><span>forma.hadoop.pail</span></a></li><li class="current"><a href="forma.hadoop.predicate.html"><span>forma.hadoop.predicate</span></a></li><li><a href="forma.hoptree.html"><span>forma.hoptree</span></a></li><li><a href="forma.matrix.utils.html"><span>forma.matrix.utils</span></a></li><li><a href="forma.matrix.walk.html"><span>forma.matrix.walk</span></a></li><li><a href="forma.ops.classify.html"><span>forma.ops.classify</span></a></li><li><a href="forma.playground.html"><span>forma.playground</span></a></li><li><a href="forma.postprocess.output.html"><span>forma.postprocess.output</span></a></li><li><a href="forma.reproject.html"><span>forma.reproject</span></a></li><li><a href="forma.schema.html"><span>forma.schema</span></a></li><li><a href="forma.source.fire.html"><span>forma.source.fire</span></a></li><li><a href="forma.source.gadmiso.html"><span>forma.source.gadmiso</span></a></li><li><a href="forma.source.hdf.html"><span>forma.source.hdf</span></a></li><li><a href="forma.source.rain.html"><span>forma.source.rain</span></a></li><li><a href="forma.source.static.html"><span>forma.source.static</span></a></li><li><a href="forma.source.tilesets.html"><span>forma.source.tilesets</span></a></li><li><a href="forma.static.html"><span>forma.static</span></a></li><li><a href="forma.testing.html"><span>forma.testing</span></a></li><li><a href="forma.thrift.html"><span>forma.thrift</span></a></li><li><a href="forma.trends.analysis.html"><span>forma.trends.analysis</span></a></li><li><a href="forma.trends.filter.html"><span>forma.trends.filter</span></a></li><li><a href="forma.trends.stretch.html"><span>forma.trends.stretch</span></a></li><li><a href="forma.utils.html"><span>forma.utils</span></a></li></ul></div><div class="sidebar" id="vars"><h3>Public Vars</h3><ul><li><a href="forma.hadoop.predicate.html#var-add-fields"><span>add-fields</span></a></li><li><a href="forma.hadoop.predicate.html#var-break"><span>break</span></a></li><li><a href="forma.hadoop.predicate.html#var-chunkify"><span>chunkify</span></a></li><li><a href="forma.hadoop.predicate.html#var-converter"><span>converter</span></a></li><li><a href="forma.hadoop.predicate.html#var-defpredsummer"><span>defpredsummer</span></a></li><li><a href="forma.hadoop.predicate.html#var-flatten-window"><span>flatten-window</span></a></li><li><a href="forma.hadoop.predicate.html#var-index"><span>index</span></a></li><li><a href="forma.hadoop.predicate.html#var-liberate"><span>liberate</span></a></li><li><a href="forma.hadoop.predicate.html#var-mangle"><span>mangle</span></a></li><li><a href="forma.hadoop.predicate.html#var-pixel-generator"><span>pixel-generator</span></a></li><li><a href="forma.hadoop.predicate.html#var-sparse-expansion"><span>sparse-expansion</span></a></li><li><a href="forma.hadoop.predicate.html#var-sparse-windower"><span>sparse-windower</span></a></li><li><a href="forma.hadoop.predicate.html#var-swap-syms"><span>swap-syms</span></a></li><li><a href="forma.hadoop.predicate.html#var-vals-%3Esparsevec"><span>vals-&gt;sparsevec</span></a></li></ul></div><div class="namespace-docs" id="content"><h2>forma.hadoop.predicate documentation</h2><pre class="doc"></pre><div class="public" id="var-add-fields"><h3>add-fields</h3><div class="usage"><code>(add-fields &amp; fields)</code></div><pre class="doc">Adds an arbitrary number of fields to tuples in a cascalog query.
</pre></div><div class="public" id="var-break"><h3>break</h3><div class="usage"></div><pre class="doc">Takes a source of textlines representing rows of a gridded
dataset (with indices prepended onto each row), and generates a
source of `row`, `col` and `val`.</pre></div><div class="public" id="var-chunkify"><h3>chunkify</h3><div class="usage"><code>(chunkify size)</code></div><pre class="doc">Return a Cascalog predicate macro that emits a tile DataChunk of a specified size.

Example usage:
 (use `forma.playground)
 (let [src [[&quot;fire&quot; nil &quot;500&quot; &quot;16&quot; 8 0 0 [1 1 1 1]]]
       query (chunkify 24000)]
       (??&lt;-
        [?tile-chunk]
        (src ?name !date ?s-res ?t-res ?h ?v ?id ?val)
        (query ?name !date ?s-res ?t-res ?h ?v ?id ?val :&gt; ?tile-chunk)))</pre></div><div class="public" id="var-converter"><h3>converter</h3><div class="usage"></div><pre class="doc">Converts between a textline with two numbers encoded as strings and
their integer representations.</pre></div><div class="public" id="var-defpredsummer"><h3>defpredsummer</h3><div class="usage"><code>(defpredsummer name vals pred)</code></div><pre class="doc">Generates cascalog defaggregateops for counting items that satisfy
some custom predicate. Defaggregateops don't allow anonymous
functions, so we went this route instead.</pre></div><div class="public" id="var-flatten-window"><h3>flatten-window</h3><div class="usage"><code>(flatten-window window)</code></div><pre class="doc">Flattens a window of nested clojure vectors into a single
vector. For example:

  (flatten-window ?chunk :&gt; ?vector)</pre></div><div class="public" id="var-index"><h3>index</h3><div class="usage"><code>(index xs &amp; {:keys [zero-index], :or {zero-index 0}})</code></div><pre class="doc">splits a sequence of values into nested 2-tuples formatted as
`&lt;idx, val&gt;`. Index supports the `zero-index` keyword argument; this
defaults to zero.</pre></div><div class="public" id="var-liberate"><h3>liberate</h3><div class="usage"><code>(liberate line)</code></div><pre class="doc">Takes a line with an index as the first value and numbers as the
rest, and converts it into a 2-tuple formatted as `[idx, row-vals]`,
where `row-vals` are sealed inside a clojure vector.

Example usage:

  (liberate &quot;1 12 13 14 15&quot;)
  ;=&gt; [1 [12 13 14 15]]</pre></div><div class="public" id="var-mangle"><h3>mangle</h3><div class="usage"><code>(mangle line)</code></div><pre class="doc">Splits textlines using the supplied regex.
</pre></div><div class="public" id="var-pixel-generator"><h3>pixel-generator</h3><div class="usage"><code>(pixel-generator tmp-path res tileseq)</code></div><pre class="doc">Returns a Cascalog generator that emits MODIS pixel tuples
[?mod-h ?mod-v ?sample ?line] for a set of MODIS tiles at a given spatial
resolution.

Arguments:
  tmp-path - A staging directory for writing tuples to a sequence file.
  res - The spatial resolution.
  tileseq - Map of country ISO keywords to MODIS tiles (see: forma.source.tilesets)</pre></div><div class="public" id="var-sparse-expansion"><h3>sparse-expansion</h3><div class="usage"><code>(sparse-expansion tuples)</code></div><pre class="doc">Receives 2-tuple pairs of the form `&lt;idx, val&gt;`, inserts each
`val` into a sparse vector at the corresponding `idx`. The `idx` of
the first tuple will be treated as the zero value. The first tuple
will `missing-val` will be substituted for any missing value.</pre></div><div class="public" id="var-sparse-windower"><h3>sparse-windower</h3><div class="usage"><code>(sparse-windower gen in-syms dim-vec val sparse-val)</code></div><pre class="doc">Aggregates cascalog generator values up into multidimensional
windows of nested vectors of `split-length` based on the supplied
vector of spatial variables. Any missing values will be filled with
`sparse-val`. This is useful for aggregating spatial data into
windows or chunks suitable for storage, or to scan across for
nearest neighbors.

`in-syms` should be a vector containing the name of each spatial
dimension variable, plus the name of the value to be aggregated. For
example, with some source `s` that would generate

  (s ?mod-h ?mod-v ?col ?row ?val)

one could wrap s like so:

  (sparse-windower s [&quot;?sample&quot; &quot;?line&quot;] 3000 &quot;?val&quot; 0)

to produce a new generator that would create

  (s ?mod-h ?mod-v ?window-col ?window-row ?window)</pre></div><div class="public" id="var-swap-syms"><h3>swap-syms</h3><div class="usage"><code>(swap-syms gen in-syms out-syms)</code></div><pre class="doc">Returns a vector of dynamic variable outputs from a cascalog
generator, with `in-syms` swapped for `out-syms`.</pre></div><div class="public" id="var-vals-%3Esparsevec"><h3>vals-&gt;sparsevec</h3><div class="usage"><code>(vals-&gt;sparsevec empty-val)</code><code>(vals-&gt;sparsevec length empty-val)</code><code>(vals-&gt;sparsevec start length empty-val)</code></div><pre class="doc">Returns an aggregating predicate macro that stitches values into a
sparse vector with all `?val`s at `?idx`, and `empty-val` at all
other places. Lines are divided into `splits` based on that input
parameter. Currently, we require that `splits` divide evenly into
`final-length`.</pre></div></div></body></html>